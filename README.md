# NSE2020 Raspberry Pi

東北大学 From The Earth が製作している NSE2020 で打ち上げ予定の機体に搭載する Raspberry Pi Camera を使ったフライトカメラ用のアプリケーションです．

## インストール

pip または pipenv でインストール出来ます．

```bash:pip の場合
$ pip install git+https://github.com/jjj999/nse2020.git
```

```bash:pipenv の場合
$ pipenv install git+https://github.com/jjj999/nse2020.git#egg=camera
```

pipenv を利用する場合は，アプリケーション実行前に仮想環境に入ってください．


## 使い方

コマンドラインツールを使ってフライトカメラを起動します．
デフォルト設定で利用する際は，

```bash
$ python -m camera
```

を実行するとアプリケーションを起動できます．


## オプション

フライトカメラを起動するコマンドにはいくつかオプションがあります．
複数のオプションを組み合わせて利用するのも可能です．

### --pin, -p

このオプションを指定すると信号線を監視するデジタル入力ピンを設定できます．
ピン番号の値は 1 ~ 26 のいずれかである必要があります．
デフォルトは 17 です．

```bash:実行例
# ピン番号を 25 にして起動
$ python -m camera -p 25
```

### --interval, -i

このオプションはデジタル入力ピンの電圧レベルを監視する時間間隔を指定します．
単位は秒で，デフォルトは 1 です．

```bash:実行例
# 監視の時間間隔を 0.5 秒にして起動
$ python -m camera -i 0.5
```

### --timeout, -t

このオプションでは撮影のタイムアウトを設定できます．
設定したタイムアウトの時間を超過すると，フライトカメラのプログラムは終了します．
単位は秒で，デフォルトではタイムアウトの設定はありません．

```bash:実行例
# タイムアウトを 10 分に設定して起動
$ python -m camera -t 600
```

### --fname, -f

このオプションは出力される動画のファイル名を指定するためのものです．
ファイル名は拡張子も含む必要があります．
デフォルトでは "mov_yyyy.mm.dd-HH.MM.SS.h264" というフォーマットで保存されます．

```bash:実行例
# ファイル名を指定して起動
$ python -m camera -f flight_movie.h264
```

### --resolution, -r

このオプションでは動画の解像度を設定できます．
指定する際は "width:height" のようにセミコロン ":" で区切って指定します．
デフォルトでは "640:480" です．

```bash:実行例
# 解像度を 200:200 にして起動
$ python -m camera -r 200:200
```

### 開発環境の構築

環境構築には pipenv を使います．
pipenv をインストールしていない場合は，

```bash
$ pip install pipenv
```

でインストールしてください．

pipenv がインストール出来たら，クローンしたリポジトリのルートで

```bash
$ pipenv install
```

を実行してください．
このとき仮想環境名 (例: nse2020-xxxxxxxxxx) がターミナル上に表示されるので，それをコピーしておきます．
そして，local.py を以下のように実行します．

```bash
$ python local.py camera nse2020-xxxxxxxxxxx
```

これは，仮想環境内の参照可能パッケージに camera パッケージを含めるための処理です．
コマンドライン引数の第1引数はパッケージ名(camera で固定)，第2引数はコピーしておいた仮想環境名です．
ここまでの処理で，開発環境と同じ環境がローカルに構築されます．

### 環境に入る

pipenv は venv を使った仮想環境を構築するので，仮想環境内でスクリプトを実行する場合は

```bash
$ pipenv shell
```

を実行し，仮想環境内に入ってスクリプトを実行してください．
